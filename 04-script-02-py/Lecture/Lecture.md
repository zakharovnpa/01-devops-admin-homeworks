### Использование Python для решения типовых DevOps задач

Алексей
МетляковАлексей Метляков
DevOps Engineer, OpenWay
Алексей Метляков

### 2План занятия
1. Для чего нужен Python?
2. Основы синтаксиса Python
3. Модули для работы с системой
4. Как написать первый скрипт?
5. Итоги
6. Домашнее задание

### 3Для чего нужен Python?

#### 4Для чего нужен Python, когда есть Bash?
Возможности Python шире, так как:
- Он является языком программирования
- Содержит большое количество встроенных функций и модулей для работы с системой, без ущерба работы с логикой
- Имеет множество загружаемых модулей для более удобной работы с любым уровнем автоматизаций

#### 5Для чего нужен Python в DevOps?
В DevOps у Python очень разносторонняя судьба:
- Автоматизация конфигурирования инфраструктуры при помощи Ansible
- Использование в инструментах автоматизации. Например, в Jenkins можно описывать шаги сборки полностью на Python
- Удобство работы с API инструментов. Существует множество готовых решений для работы с API Bitbucket, GitLab, GitHub, Nexus, Crowd, Jira, Conﬂuence, etc.

### 6Основы синтаксиса Python

#### 7Переменные
В Python используется неявное определение переменных:
- Определение типа переменной происходит динамически
- Любой тип переменной можно преобразовать в любой другой тип: int(s), str(i), ﬂoat(i)
- Следить за типом переменных и контролировать их переопределение - наша задача
- Определить тип переменной можно при помощи type(имя_переменной)

```python
root@PC-Ubuntu:~# 
root@PC-Ubuntu:~# python3
Python 3.8.10 (default, Nov 26 2021, 20:14:08) 
[GCC 9.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> 
>>> 
>>> a = 12
>>> 
>>> a
12
>>> 
>>> print(a)
12
>>> 
>>> type(a) # Определить тип переменной
<class 'int'> # Класс целых чисел
>>> 
>>> 
>>> str(a)
'12'
>>> 
>>> type(str(a))
<class 'str'>
>>> float(a)
12.0
>>> 
>>> a + 34
46
>>> 
>>> a = 'Hello'
>>> 
>>> a + 34
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: can only concatenate str (not "int") to str
>>> 
>>> 
>>> a + str(34)
'Hello34'
>>> 
>>> int(a)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ValueError: invalid literal for int() with base 10: 'Hello'
>>> 
>>> array_list = ['Hello', 123, 23.4, [1,2,3]]
>>> 
>>> array_list[0]
'Hello'
>>> 
>>> array_list[1]
123
>>> 
>>> array_list[2]
23.4
>>> 
>>> array_list[3]
[1, 2, 3]
>>> 
```

#### 8Массивы
Массивы в Python - не такие, как в привычном понимании программиста.
Существует несколько видов:
- Упорядоченный, редактируемый (list) [‘a’, 23, ‘hello’]
- Упорядоченный, нередактируемый (tuple) (14, ‘yes’, ‘no’)
- Неупорядоченный, редактируемый, уникальный (set) {H,e,l,o}
- Неупорядоченный, key-value (dict) {1:’Январь’, 2:’Февраль’}

```python
### Когда пишется type -  на самом деле это класс. В Python абсолютно все является экземплярами классов. И когда мы что-то создаем, мы можем на это применить методы
>>> array_list = ['Hello', 123, 23.4, [1,2,3]] # Массив из четырех элементов. Четвертый- это вложенный массив
>>> 
>>> array_list[0]     # Вывод значения первого элемента массива
'Hello'
>>> 
>>> array_list[1]     # Вывод значения второго элемента массива
123
>>> 
>>> array_list[2]     # Вывод значения третьего элемента массива
23.4
>>> 
>>> array_list[3]     # Вывод значения четвертого элемента массива
[1, 2, 3]
>>> 
>>> type(array_list[0])
<class 'str'>
>>> 
>>> type(array_list[1])
<class 'int'>
>>> 
>>> type(array_list[2])
<class 'float'>
>>> 
>>> type(array_list[3])
<class 'list'>
>>> 

# Итерация по элеметнам вложенного массива
>>> 
>>> array_list[3][0]     # Вывод значения первого элемента массива
1
>>> 
>>> 
>>> array_list[3][1]     # Вывод значения второго элемента массива
2
>>> 
>>> array_list[3][2]     # Вывод значения третьего элемента массива
3
>>> 
>>> array_list[3][3]     # Вывод значения несуществующего четвертого элемента массива
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
IndexError: list index out of range
>>> 

```
```python

>>> 
>>> type(array_list[3][0])
<class 'int'>
>>> 
>>> type(array_list[3][1])
<class 'int'>
>>> 
>>> type(array_list[3][2])
<class 'int'>
>>> 

```
##### Возможности преобразования строк
```python
>>> a = 'Hello'

```

##### 
```python
# Метод разделения
>>> a.split(' ')
['Hello', 'world']
>>> 

# Получили тип List И дальше мы можемр аботать с литом
>>> type(a.split(' '))
<class 'list'>
>>> 
>>> 
```

```pytjon
## Метод соединения (обратный разделению)
>>> ' '.join(a.split(' '))
'Hello world'
>>> 
>>> 
>>> 
```

```python
>>> ', '.join(a.split(' '))
'Hello, world'
>>> 

```
```python
>>> a
# Разделяем
'Hello world'
>>> 
>>> a = a.split(' ')
>>> 

#  Видим, что массив состоит теперь из двух элементов
>>> a
['Hello', 'world']
>>> 

# Добавляем еще один элемент
>>> a.append('!')
>>> 

# Теперь массив состоит из трех элементов
>>> a
['Hello', 'world', '!']
>>> 
>>> 

# Соединяем элементы в один элемент массива
>>> ', '.join(a)
'Hello, world, !'
>>> 

#  Есть метод расширения  одного листа с другим - extend
>> b = [1, 2, 3]
>>> 
>>> 
>>> a
['Hello', 'world', '!']
>>> 
>>> b
[1, 2, 3]
>>> 
>>> a.extend(b) 
>>> 
>>> a
['Hello', 'world', '!', 1, 2, 3]
>>> 
>>> b
[1, 2, 3]
>>> 

# Расширение масива b по массиву a
>>> a
['Hello', 'world', '!', 1, 2, 3]
>>> 
>>> a = 'Hello world'
>>> 
>>> b = [1, 2, 3]
>>> 
>>> b.extend(a) 
>>> 
>>> b
[1, 2, 3, 'H', 'e', 'l', 'l', 'o', ' ', 'w', 'o', 'r', 'l', 'd']
>>> 
>>> a
'Hello world'
>>> 


```

#### 9Операции
Python поддерживает:
- весь набор арифметических операций
- весь набор логических операций
- конкатенацию строк, сравнение с эталоном, поиск подстроки

#### 10Оператор условия
Конструкция if-elif-else в Python имеет следующий синтаксис:
```python
if (условие):
    список действий
elif (условие):
    список действий
else:
    список действий
```

#### 11Циклы
Существует два вида конструкций циклов:
```python

sample=[0,1,2,3,4,5,6]
  for (i in sample):
    print(str(i)) ------------> Выводим построчно
                                значения элементов
                                массива


a = 0
while (a < 5):
print(a)
a += 1 ------------>  Выводим значение
                      переменной

```

### 12Модули для работы с системой

#### 13Модуль sys
Модуль обеспечивает доступ к некоторым функциям и
переменным, которые взаимодействуют с интерпретатором:
```python
sys.args #Возвращает список параметров, переданных скрипту
sys.exit() #Возбуждает исключение SystemExit и завершает работу
sys.platform #Возвращает наименование ОС
sys.getsizeof() #Возвращает размер объекта в байтах
```

#### 14Модуль os
Модуль позволяет взаимодействовать с ОС при помощи
разнообразных функций:
os.getlogin() #Возвращает логин текущего пользователя
os.getuid() #Возвращает id текущего пользователя
os.uname() #Возвращает информацию о системе
os.access(path, flag) #Проверяет доступность файла
os.getcwd() #Возвращает текущий каталог
os.popen() #Выполняет системную команду и позволяет
записать вывод в переменную
os.makedirs(path) #Создаёт директорию по всему пути
os.truncate(path, length) #Обрезает файл до указанной длины
os.walk() #Рекурсивно собирает информацию о файлах

#### 15Как написать первый скрипт?
16Как написать первый скрипт
Существует ряд основных правил для формирования
правильного python-скрипта:
● Скрипт может начинаться с #!/usr/bin/env python3
● Стараться писать в соответствии с PEP8
17Итоги
Сегодня мы:
● Узнали для каких DevOps-задач можно использовать Python
● Вспомнили основы синтаксиса
● Познакомились с двумя модулями для работы с системой
● Узнали как написать свой первый скрипт
18Домашнее задание
Давайте посмотрим ваше домашнее задание.
● Вопросы по домашней работе задавайте в чате мессенджера
Slack.
● Задачи можно сдавать по частям.
● Зачёт по домашней работе проставляется после того, как
приняты все задачи.
19Задавайте вопросы и
пишите отзыв о лекции!
Алексей Метляков
Алексей Метляков
